---
title: "Bicycle Theft Report"
subtitle: "What is the scope of bike theft in Toronto over the past few years?"
author: "Chris Yan 1009096746, Aaron Dong 1008961232, Armaan Rehman Shah 1009641309"
date: "2023-04-07"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo=FALSE}
# Importing the dataset
origin <- read.csv("bicycle.csv")
```

```{r, include=FALSE}
# Initiating libraries
library(tidyverse)
library(ggplot2)
library(ggmap)
library(png)
library(ggpubr)
library(osmdata)
library(gganimate)
```

## Introduction

The report concerns with the data "Bicycle Thefts Open Data" which contains occurrences related to bicycle thefts reported to the Toronto Police Service. 
These occurrences are related to a variety of offences where the theft of a bicycle was included. We obtained this dataset from the City of Toronto Open Data portal. It records all of the bike thefts in Toronto starting from as early as 2013. 
The dataset is published by the Toronto Police services and is refreshed annually with the most recent publish being 2022. The dataset contains large amount of entries and multiple information variables\

### Purpose

The purpose of our report is to inform the public about the bike safety concerns in Toronto and its surrounding areas with regards to the precedence of stolen bikes in certain areas. We want to make it known in our report that the public should avoid parking bikes in hot-spots where bikes are often stolen. A map of the density of the stolen bike occurrences will show the precise locations where one should avoid leaving their bike. With our research we hope to provide a thorough investigation into these hot-spots and also provide such information of stolen bike occurrences to the Toronto Police.
\pagebreak

### Dataset Description

-   **entry id named X_id**
    -   unique entry id in increasing order
    -   *integer*
-   **event id named event_unique_id**
    -   unique event id not sorted
    -   *string*
-   **offense committed named Primary_Offense**
    -   type of crime that is committed
    -   *string*
-   **offense occurrence date named Occurrence_Date**
    -   date of when the crime was committed
    -   *string*
-   **offense occurrence year named Occurrence_Year**
    -   year of when the crime was committed
    -   *integer*
-   **offense occurrence month named Occurrence_Month**
    -   month of when the crime was committed
    -   *string*
-   **offense occurrence day of the week named Occurrence_DayOfWeek**
    -   what days of week was the crime committed (from Mon to Sun)
    -   *string*
-   **offense occurrence date of the month named Occurrence_DayOfMonth**
    -   what date of the month was the crime committed (from 1-31)
    -   *integer*
-   **offense occurrence day of the year named Occurrence_DayOfYear**
    -   what day of the year was the crime committed (from 1-365)
    -   *integer*
-   **offense occurrence hour named Occurrence_Hour**
    -   what hour of the day was the crime committed (from 1-24)
    -   *integer*
-   **offense report date named Report_Date**
    -   when the incident was reported to the authorities
    -   *string*
-   **offense report year named Report_Year**
    -   which year was the incident reported
    -   *integer*
-   **offense report month named Report_Month**
    -   which month was the incident reported
    -   *string*
-   **offense report day of the week named DayOfWeek**
    -   which day of week was the incident reported (Mon - Sun)
    -   *string*
-   **offense report day of the month named DayOfMonth**
    -   which day of the month was the incident reported (from 1-31)
    -   *integer*
-   **offense report day of the year named DayOfYear**
    -   which day of the year was the incident reported (from 1-365)
    -   *integer*
-   **offense report hour named Report_Hour**
    -   which hour of the day was the incident reported
    -   *integer*
-   **division where offense named Division**
    -   the division of the location, mostly used to identify the police service responsible
    -   *string*
-   **city where offense where offense took place named City**
    -   city name in or around Toronto
    -   *string*
-   **hood where offense took place named Hood_ID**
    -   the hood id for all Toronto's neighborhoods (out of 158)
    -   *string*
-   **neighborhood where offense took place named NeighbourhoodName**
    -   the neighborhood name in Toronto and surrounding areas
    -   *string*
-   **location where offense took place named Location_Type**
    -   broad description of the crime location.
    -   *string*
-   **location premise of where offense took place named Premise_Type**
    -   description of where bike was stolen
    -   *string*
-   **bike make of stolen bike named Bike_Make**
    -   brand of bike that was stolen.
    -   *string*
-   **bike model of stolen bike named Bike_Model**
    -   model of bike that was stolen.
    -   *string*
-   **bike type of stolen bike named Bike_Type**
    -   type of bike that was stolen
    -   *string*
-   **bike speed of stolen bike named Bike_Speed**
    -   the assumed speed of the bike
    -   *integer*
-   **bike color of stolen bike named Bike_Colour**
    -   colour of the bike that was stolen.
    -   *string*
-   **cost of stolen bike named Cost_of_Bike**
    -   cost of bike that was stolen.
    -   *double*
-   **condition of stolen bike named Status**
    -   current condition of the bike (STOLEN, RECOVERED, or UNKNOWN)
    -   *string*
-   **coordinates of bike stolen named Geometry**
    -   precise location of the crime location
    -   *string*

\pagebreak
As with all the data, let us do a preliminary safety removal of any data that has NA entries.
In addition, let us print out a summary of crimes by year to see if there are any outliers.\
\
**Figure 1: Total Number of Bike Thefts Each Year**
```{r, echo=FALSE}
#omit all the entries that has NA inputs, they won't be helpful to our data
data <- na.omit(origin)
summary <- table(data$Occurrence_Year)
print(summary)
```
We can see that there are some outliers from 2009-2013. In addition, the 2022 data is not complete. Let us filter them out and obtain a complete data, the one we will be using for our report below.\
\
**Figure 2: Data After Filtering Incomplete Years**
```{r}
data = data %>% filter(Occurrence_Year >= 2014) %>%
  filter(Occurrence_Year < 2022)
summary_table = data %>% count(Occurrence_Year) %>% 
  rename(Year = Occurrence_Year, Theft_Count = n)
print(summary_table)
```
\newpage
```{r}
# Calculate average cost of bike by year
avg_cost_by_year <- data %>%
  group_by(Occurrence_Year) %>%
  summarize(avg_cost = mean(Cost_of_Bike))

# Create plot of average cost of bike by year
ggplot(avg_cost_by_year, aes(x = Occurrence_Year, y = avg_cost)) +
  geom_line(color = "blue") +
  geom_point(color = "blue") +
  labs(x = "Occurrence Year", y = "Average Cost of Bike") +
  ggtitle("Average Cost of Stolen Bikes by Occurrence Year")


#do a line of best fit
```

\newpage

```{r}
ggplot(data = data, aes(x = Occurrence_Hour)) +
  geom_histogram(binwidth = 1, color = "black", fill = "lightblue") +
  labs(x = "Occurrence Hour", y = "Number of Thefts") +
  ggtitle("Number of Thefts During each Hour")
```

\pagebreak

The graph below shows the amount of bikes stolen in the first half of years 2019 and 2020.

```{r}

data2 = data %>% filter(Occurrence_Year %in% c(2019,2020,2021) & Report_DayOfYear<=182)

ggplot(data2, aes( x=Report_DayOfYear)) +
  geom_histogram(aes(fill=factor(Occurrence_Year)),alpha=0.5)+
  labs(fill="Occurrence_Year") +
  ggtitle("Bike Thefts in the first half of recent years")
```

We can deduce that a significantly higher number of bikes were stolen in the first half of 2019 than 2020.

Let's now take a sample of 1000 observations from the dataset and construct a 97% confidence interval for the proportion of bikes stolen on a Monday. Let's also construct a 97% Bootstrap confidence interval for the proportion of buildings not violating a code:

```{r}
# Confidence interval - Armaan

samp = data %>% sample_n(1000)

prop.test(x = sum(samp$Occurrence_DayOfWeek == "Monday"), n = length(samp$Occurrence_DayOfWeek), conf.level = 0.97)

# Bootstrapping

boot_function = function(){
  
  boot_data = samp  %>% sample_n(nrow(samp), replace = T)
  
  boot_prop = mean(boot_data$Occurrence_DayOfWeek == "Monday")
  
  return(boot_prop)
  
}

quantile(replicate(1000, boot_function()), c(0.1, 0.9))

```

From this, we know that ...

Now, let's create a summary table to find out the most frequent type of bike stolen (Bike_Make and Bike_Colour) in 2013

```{r}

data3 = origin %>%
  filter(Occurrence_Year == 2013) %>%
  group_by(Occurrence_Year, Bike_Make, Bike_Colour) %>%
  summarise(total = sum(n=n())) %>%
  arrange(Occurrence_Year, total)
as.data.frame(data3)
```

From the above table, we can notice that the most frequent type of bike stolen in 2013 was a CCM with color blue.

